# Challenge 08 ‚Äî NFT Provenance (Sepolia)
The goal of this challenge is to register **DDM artifacts on-chain** (NFT Provenance) using the deployed smart contracts on **Ethereum Sepolia**, and then **claim rewards**.

Specifically, you will:

1. **Update your DDM profile** with your Sepolia Account Public Key

2. **Create an on-chain Dataset Request** (and optionally fund it), using artifacts generated by the DDM **Data Quality** and **Metadata Enrichment** services.  
   You can configure the request with:
   - the number of datasets expected  
   - a specific category/field (e.g. *transportation*)  
   - specific format(s) (e.g. *parquet*)  
   - a required deadline  
   - qualitative/reproducibility information coming from the **Expectation Suite** package created in Challenge **05 (Step 7)**  

   After the Dataset Request registration, you will receive an **NFT** in your wallet representing the certificate for this specific request.

3. **Register a Dataset for a request** and optionally attach a DDM-generated report, as shown in Challenge **05 (Step 4)**.  
   To do so, you will sign an **ECDSA signature** produced by DDM for the specific **dataset fingerprint**, and then register the dataset on-chain.

4. **Datasets are validated** by registered services and human validators.  
   These can also be registered at runtime by DDM backend nodes operating as **Governors** under the **OpenZeppelin Governance** schema.

   In this challenge, datasets are validated:
   - against the expectation suite included in the on-chain Dataset Request (**IPFS link attached in the on-chain record**)  
   - against an **LLM ethical assessment service** (**IPFS link attached in the on-chain record**)  
   - by **human validators** (**IPFS link attached with duties**)  

   Services and human validators provide immutable results via **IPFS URI links on-chain**, along with validation reports.

5. After **3 successful validations**, users can **claim rewards** (if the dataset request was funded) and receive an **NFT certificate** of a high-quality dataset in their wallet, connected with the validation IPFS links.


---

## Prerequisites

### 1) Install dependencies

From the project root:

```powershell
pip install -e ".[dev]"
```

### 2) Configure `.env` (Sepolia + Infura + Private Key)

To interact with the blockchain you need:
- A Sepolia RPC URL (Infura recommended)
- A wallet private key with some Sepolia ETH (gas fees)

Example `.env`:

```env
# Sepolia RPC (Infura)
SEPOLIA_RPC_URL=https://sepolia.infura.io/v3/<YOUR_INFURA_PROJECT_ID>
DDM_RPC_URL=https://sepolia.infura.io/v3/<YOUR_INFURA_PROJECT_ID>

# signing key (MetaMask Export Private Key)
DDM_USER_PK=0x...
```

> ‚ö†Ô∏è Never commit private keys.

### 3) Ensure you have Sepolia ETH

You need Sepolia ETH for gas.

Recommended faucet:
- https://faucet.chainstack.com/sepolia-testnet-faucet

Alternative: (pending development)
- Login to https://ddm.extremexp-icom.intracom-telecom.com/
- **Edit profile** and save your `public key`  
- A tip will be transferred to your wallet

---

## Sample files

Example inputs used in this guide : `sample_files/`
- `\challenges\sample_files\prepare_validation.json`


## Step-by-step

> Run these commands **from the project root**.

---

### 1) Update profile (optional but recommended)

This step registers/updates your wallet profile on-chain.

```powershell
python .\challenges\challenge_08_nft_provenance\01_update_profile.py `
  --username "<YOUR_USERNAME>" `
  --public_key "<YOUR_WALLET_ADDRESS>" `
```

---

### 2) Registera dataset request (on-chain)

This step prepares and registers an **Expectation Suite** on Sepolia.

You need a suite.json file produced by Challenge 05 (or your own suite creation).

Example path (generated by storage):
```text
out/runtime/expectations/suites/<SUITE_ID>/suite.json
```
Fill in the `suite_id` from task 7 in clanllenge 5.

Command:

```powershell
python .\challenges\challenge_08_nft_provenance\02_register_dataset_request.py `
  --json-file ".\out\runtime\expectations\suites\<SUITE_ID>\suite.json" `
  --requester "<YOUR_WALLET_ADDRESS>" `
  --deadline 1860000000 `
  --category crisis `
  --totalExpected 10 `
  --bounty-eth 0.001 `
  --poll --timeout 600 --prepare-interval 1 --register-interval 2
```

‚úÖ After successful registration:
- Visit the **Suite Requests Dashboard** to see your request under **Dataset Request Registry** (toggle the events too):  
  https://ddm.extremexp-icom.intracom-telecom.com/suite-requests-dashboard
- Visit **Blockchain / Contracts** to see transactions and emitted events:  
  https://ddm.extremexp-icom.intracom-telecom.com/blockchain/contracts
- Verify the transaction on Sepolia Etherscan:
  https://sepolia.etherscan.io/tx/<TX_HASH_FROM_LOGS>
- In **MetaMask ‚Üí NFTs**, you should see an **NFT** representing your Dataset Request üì¶‚ú®
---

### 3) Register dataset (on-chain)

This step registers a dataset on-chain, linked to:
- `suite_id`
- `catalog_id` (DDM catalog/file id)
- `dataset-uri` (IPFS URI generated by DDM)

Example command:

```powershell
python .\challenges\challenge_08_nft_provenance\03_register_dataset.py `
  --network sepolia `
  --suite_id "<SUITE_ID_FROM_STEP_2>" `
  --catalog_id "<CATALOG_ID_OR_FILE_ID>" `
  --dataset-uri "projects/tutorial-<username>/files/<FILE_ID>/<FILE_ID>.csv" `
  --poll --timeout 600 --prepare-interval 2 --register-interval 2
```

‚úÖ After success:
- The script prints a `dataset fingerprint` ‚Äî copy it (needed for Step 4).
- You can inspect the Dataset Registry + events here:  
  https://ddm.extremexp-icom.intracom-telecom.com/suite-requests-dashboard
- You can inspect transactions/events here:  
  https://ddm.extremexp-icom.intracom-telecom.com/blockchain/contracts
- Verify the transaction on Sepolia Etherscan:
  https://sepolia.etherscan.io/tx/<TX_HASH_FROM_LOGS>

---

### 4) Register validation (on-chain)

This step registers a validation result linked to the dataset fingerprint.

You need:
- `dataset fingerprint` from Step 3
- a JSON file describing the validation payload (example: `prepare_validation.json`)
- whether the validation was `successful`

Edit file: `challenges/sample_files/prepare_validation.json`
Example 'prepare_validation.json':
```
  {
    "network": "sepolia",
    "dataset_fingerprint": "0x<PASTE_FINGERPRINT_FROM_STEP_3>",
    "uploader": "0x<YOUR_WALLET_ADDRESS>",
    "validation_json": { "score": 100 },
    "include_report": true
  }
```


Fill these fields:

- `network`: keep as "sepolia"
- `dataset_fingerprint`: paste the fingerprint printed in Step 3 (Register dataset)
- `uploader`: your wallet address (same as your public_key in profile / MetaMask address)
- `validation_json`: any validation payload you want to attach (example score)
- `include_report`: true if you want to attach/upload the DDM report artifact too

Example:

```powershell
python .\challenges\challenge_08_nft_provenance\04_register_validation.py `
  --network sepolia `
  --dataset-fingerprint "<DATASET_FINGERPRINT_FROM_STEP_3>" `
  --json-file .\challenges\sample_files\prepare_validation.json" `
  --successful true `
  --poll --timeout 600 --prepare-interval 1 --register-interval 2
```
‚ö†Ô∏è Important note   
The on-chain **register validation** transaction **reverts** if your wallet is **not** a registered validator.  
You can check registered validators under the **ValidatorsRegistry** (via UI/contracts/events):

- Dashboard + events:  
  https://ddm.extremexp-icom.intracom-telecom.com/suite-requests-dashboard
- All on-chain contracts/transactions/events:  
  https://ddm.extremexp-icom.intracom-telecom.com/blockchain/contracts

‚úÖ In that case: **wait for the human validators** to validate your dataset.  
(They usually check at least once per day ‚è≥)

---

### 5) Claim rewards

This step claims the bounty/reward for the dataset & validation combination.

You need:
- `suite_id` from Step 2
- `catalog_id` from Step 3
- `category` used in suite registration (e.g. crisis)

Example:

```powershell
python .\challenges\challenge_08_nft_provenance\05_claim_rewards.py `
  --project_id tutorial `
  --network sepolia `
  --suite_id "<SUITE_ID_FROM_STEP_2>" `
  --catalog_id "<CATALOG_ID_FROM_STEP_3>" `
  --category crisis `
  --poll --timeout 600 --prepare-interval 1 --claim-interval 2
```
‚úÖ After a successful claim:
- Your wallet receives a **Dataset NFT** üèÖ (certificate of a high-quality dataset)
- The `NFT` is linked to the validation `IPFS results` and proves completion of the tutorial üéâ
- You can track contract `event`s here:  
  https://ddm.extremexp-icom.intracom-telecom.com/blockchain/contracts
- Verify the transaction on `Sepolia Etherscan`:
  https://sepolia.etherscan.io/tx/<TX_HASH_FROM_LOGS>

---

### 6) Get user notifications üîî

Human validators may take some time to validate your dataset(s).  
Use this step to fetch your latest notifications from the DDM backend.

> Run this from the project root.

#### Get unread notifications (recommended)

```powershell
python .\challenges\challenge_08_nft_provenance\06_get_notifications.py `
  --username "<YOUR_USERNAME>" `
  --only_unread `
  --limit 50
```

#### Get all notifications

```powershell
python .\challenges\challenge_08_nft_provenance\06_get_notifications.py `
  --username "<YOUR_USERNAME>" `
  --limit 50
```

**DDM Notifications Panel:** Optionally open notifications panel in sidebar
  https://ddm.extremexp-icom.intracom-telecom.com/


‚úÖ Tips:
- Look for notifications related to on-chain validations and reward eligibility.
- When you see a notification that validations are completed ‚úÖ, proceed to **Step 5 (Claim rewards)**.
- For any on-chain action, also check the transaction hash on Etherscan:
  https://sepolia.etherscan.io/tx/<TX_HASH>


## What to submit

You need to provide:
- Transaction hashes from suite/dataset/reward actions
- The dataset fingerprint
- Screenshots of NFTS in Metamask wallet for successful dataset / dataset request registration
